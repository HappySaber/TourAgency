{{ define "content" }}
<h2>Редактировать тур</h2>
<form id="editTourForm">
    <label>Название:</label><br>
    <input type="text" name="name" value="{{ .Tour.Name }}" required><br><br>

    <label>Рейтинг:</label><br>
    <input type="text" name="rating" value="{{ .Tour.Rating }}"><br><br>

    <label>Отель:</label><br>
    <input type="text" name="hotel" value="{{ .Tour.Hotel }}"><br><br>

    <label>Питание:</label><br>
    <input type="text" name="nutrition" value="{{ .Tour.Nutrition }}"><br><br>

    <label>Город:</label><br>
    <input type="text" name="city" value="{{ .Tour.City }}"><br><br>

    <label>Страна:</label><br>
    <input type="text" name="country" value="{{ .Tour.Country }}"><br><br>

    <label>Провайдер:</label><br>
    <select name="provider" required>
        <option value="">-- Выберите провайдера --</option>
        {{ range .Providers }}
        <option value="{{ .ID }}" {{ if eq .ID $.Tour.ProviderID }}selected{{ end }}>{{ .Name }}</option>
        {{ end }}
    </select><br><br>

    <button type="submit">Сохранить изменения</button>
</form>

<script>
    document.getElementById("editTourForm").addEventListener("submit", async function(e) {
        e.preventDefault();
    
        const id = document.getElementById("id").value;
    
        const provider = {
            name: document.getElementById("name").value,
            rating: document.getElementById("rating").value,
            hotel: document.getElementById("hotel").value,
            nutrition: document.getElementById("nutrition").value,
            city: document.getElementById("city").value,
            country: document.getElementById("country").value,
            provider: document.getElementById("provider").value
        };
    
        const res = await fetch(`/providers/edit/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(provider)
        });
    
        if (res.ok) {
            alert("Обновлено");
            window.location.href = "/tours";
        } else {
            const data = await res.json();
            alert(data.error || "Ошибка");
        }
    });
    </script>
{{ end }}
{{ template "base.html" }}
