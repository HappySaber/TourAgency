{{ define "content" }}
<h2>–°–ø–∏—Å–æ–∫ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π</h2>

<table border="1" cellpadding="5" cellspacing="0">
    <thead>
        <tr>
            <th>–î–∞—Ç–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</th>
            <th>–í—Ä–µ–º—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</th>
            <th>–ö–ª–∏–µ–Ω—Ç</th>
            <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
            <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
    </thead>
    <tbody>
        {{ range .Consultations }}
        <tr>
            <td>{{ .DateOfConsultation.Format "2006-01-02" }}</td>
            <td>{{ .TimeOfConsultation.Format "15:04:05" }}</td>
            <td>{{ .Client.Firstname }} {{ .Client.Lastname }}</td>
            <td>{{ .Employee.FirstName }} {{ .Employee.LastName }}</td>
            <td>{{ .Notes }}</td>
            <td>
                <a href="/consultation/edit/{{ .ID }}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                <a href="/consultation/{{ .ID }}/tours">üß≥ –¢—É—Ä—ã</a><br>
                <a href="/consultation/{{ .ID }}/services">üõ† –£—Å–ª—É–≥–∏</a><br>
                <button onclick="deleteConsultation('{{ .ID }}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
            </td>
        </tr>
        {{ end }}
    </tbody>
</table>

<br>
<a href="/consultation/new">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</a>

<script>
async function deleteConsultation(id) {
    if (!confirm("–£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é?")) return;

    try {
        const res = await fetch(`/consultation/${id}`, {
            method: "DELETE",
            headers: { "Content-Type": "application/json" }
        });

        if (res.ok) {
            alert("–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞");
            location.reload();
        } else {
            const data = await res.json();
            alert(data.error || "–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏");
        }
    } catch (err) {
        alert("–û—à–∏–±–∫–∞: " + err.message);
    }
}
</script>
{{ end }}
{{ template "base.html" }}
